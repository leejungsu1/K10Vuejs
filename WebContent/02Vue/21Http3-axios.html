<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        $(function(){
            var vue = new Vue({
                el : '#app',
                data : {
                    title : 'Http통신 - axios.get()',
                    httpData : ''
                },
                methods : {
                    testFunc : function(param){
                        console.log("testFunc()", param);
                    },
                    getData : function(tname){
                        let a = '';
                        axios.get('http://nakja.co.kr/kosmoAPI/json/board_list_json.php?tname='+tname)
                        .then((resData)=>{
                            /*
                            then절 안에서 함수를 정의할때 화살표함수가 아닌
                            일반 함수를 정의하면 아래 this는 vue객체가 아닌
                            window객체를 가리키게 된다. 따라서 해당 문장은
                            실행되지 않는다. 화살표함수를 사용하면 항상 내가
                            호출하는 해당 객체를 가리키게 된다.
                            */
                            console.log("화살표함수this",this);
                            this.httpData = resData.data;
                            return "여기서 반환하면 다음 then함수로 전달됨"
                        })
                        .catch(function(){
                            console.log("예외발생");
                        })
                        .then((d)=>{
                            //화살표함수로 정의했으므로 호출가능함
                            console.log("일반함수this",this)
                            this.testFunc(d);
                            outFunc();
                        });
                        // .then((d)=>{//window객체가 된다.
                        //     this.testFunc(d);//호출할 수없어 에러발생됨.
                        //     outFunc();
                        // });
                    }
                }
            });
            vue.getData('nboard_news');
        }); 
        function outFunc(){
            console.log('나 호출되고 있니?');
        }
    </script>
</head>
<body>
    <div id="app">
        <h2>{{title}}</h2>
        <button type="button" v-on:click="getData('nboard_news')">news게시판</button>
        <button type="button" v-on:click="getData('nboard_jquery')">jquery게시판</button>
        <button type="button" v-on:click="getData('nboard_homepage')">nboard_homepage게시판</button>

        <table border="1" style="width: 700px;">  
            <colgroup>
                <col width="10%">
                <col width="*">
                <col width="10%">
                <col width="15%">
                <col width="10%">
            </colgroup>
            <tr>
                <th>No</th>
                <th>제목</th>
                <th>작성자</th>
                <th>작성일</th>
                <th>조회수</th>
            </tr>
            <tr v-for="(row, idx) in httpData">
                <td>{{row.idx}}</td>
                <td>{{row.subject}}</td>
                <td>{{row.name}}</td>
                <td>{{row.regdate}}</td>
                <td>{{row.hit}}</td>
            </tr>
        </table>

    </div>  
</body>
</html>